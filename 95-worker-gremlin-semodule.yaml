kind: MachineConfig
apiVersion: machineconfiguration.openshift.io/v1
metadata:
  name: 95-worker-gremlin-semodule  # RECOMMEND CHANGE NAME TO MATCH NODE ROLE
  creationTimestamp: 
  labels:
    machineconfiguration.openshift.io/role: worker # CHANGE TO MATCH NODE ROLE
spec:
  osImageURL: ''
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
      - filesystem: root
        path: "/etc/selinux/gremlin-ocp4.cil"
        contents:
          source: data:text/plain;charset=utf-8;base64,KGJsb2NrIGNvbnRhaW5lcgoodHlwZSBwcm9jZXNzKQoodHlwZSBzb2NrZXQpCihyb2xldHlwZSBzeXN0ZW1fciBwcm9jZXNzKQoodHlwZWF0dHJpYnV0ZXNldCBkb21haW4gKHByb2Nlc3MgKSkKKHR5cGVhdHRyaWJ1dGVzZXQgY29udGFpbmVyX2RvbWFpbiAocHJvY2VzcyApKQoodHlwZWF0dHJpYnV0ZXNldCBzdmlydF9zYW5kYm94X2RvbWFpbiAocHJvY2VzcyApKQoodHlwZWF0dHJpYnV0ZXNldCBmaWxlX3R5cGUgKHNvY2tldCApKQooYWxsb3cgcHJvY2VzcyBzb2NrZXQgKHNvY2tfZmlsZSAoY3JlYXRlIG9wZW4gZ2V0YXR0ciBzZXRhdHRyIHJlYWQgd3JpdGUgcmVuYW1lIGxpbmsgdW5saW5rIGlvY3RsIGxvY2sgYXBwZW5kKSkpCihhbGxvdyBwcm9jZXNzIHByb2NfdHlwZSAoZmlsZSAoZ2V0YXR0ciBvcGVuIHJlYWQpKSkKKGFsbG93IHByb2Nlc3MgY3B1X29ubGluZV90IChmaWxlIChnZXRhdHRyIG9wZW4gcmVhZCkpKQooYWxsb3cgY29udGFpbmVyX3J1bnRpbWVfdCBwcm9jZXNzIChrZXkgKGNyZWF0ZSBsaW5rIHJlYWQgc2VhcmNoIHNldGF0dHIgdmlldyB3cml0ZSkpKQopCihibG9jayBuZXRfY29udGFpbmVyCgkoYmxvY2tpbmhlcml0IGNvbnRhaW5lcikKCSh0eXBlYXR0cmlidXRlc2V0IHNhbmRib3hfbmV0X2RvbWFpbiAocHJvY2VzcykpCikKCihibG9jayByZXN0cmljdGVkX25ldF9jb250YWluZXIKICAgIChibG9ja2luaGVyaXQgY29udGFpbmVyKQoKICAgIChhbGxvdyBwcm9jZXNzIHByb2Nlc3MgKHRjcF9zb2NrZXQgKGlvY3RsIHJlYWQgZ2V0YXR0ciBsb2NrIHdyaXRlIHNldGF0dHIgYXBwZW5kIGJpbmQgY29ubmVjdCBnZXRvcHQgc2V0b3B0IHNodXRkb3duIGNyZWF0ZSBsaXN0ZW4gYWNjZXB0KSkpCiAgICAoYWxsb3cgcHJvY2VzcyBwcm9jZXNzICh1ZHBfc29ja2V0IChpb2N0bCByZWFkIGdldGF0dHIgbG9jayB3cml0ZSBzZXRhdHRyIGFwcGVuZCBiaW5kIGNvbm5lY3QgZ2V0b3B0IHNldG9wdCBzaHV0ZG93biBjcmVhdGUpKSkKICAgIChhbGxvdyBwcm9jZXNzIHByb2Nlc3MgKHNjdHBfc29ja2V0IChpb2N0bCByZWFkIGdldGF0dHIgbG9jayB3cml0ZSBzZXRhdHRyIGFwcGVuZCBiaW5kIGNvbm5lY3QgZ2V0b3B0IHNldG9wdCBzaHV0ZG93biBjcmVhdGUpKSkKCiAgICAoYWxsb3cgcHJvY2VzcyBwcm9jX3QgKGxua19maWxlIChyZWFkKSkpCgogICAgKGFsbG93IHByb2Nlc3Mgbm9kZV90IChub2RlICh0Y3BfcmVjdiB0Y3Bfc2VuZCByZWN2ZnJvbSBzZW5kdG8pKSkKICAgIChhbGxvdyBwcm9jZXNzIG5vZGVfdCAobm9kZSAodWRwX3JlY3YgcmVjdmZyb20pKSkKICAgIChhbGxvdyBwcm9jZXNzIG5vZGVfdCAobm9kZSAodWRwX3NlbmQgc2VuZHRvKSkpCgogICAgKGFsbG93IHByb2Nlc3Mgbm9kZV90ICh1ZHBfc29ja2V0IChub2RlX2JpbmQpKSkKICAgIChhbGxvdyBwcm9jZXNzIG5vZGVfdCAodGNwX3NvY2tldCAobm9kZV9iaW5kKSkpCgogICAgKGFsbG93IHByb2Nlc3MgaHR0cF9wb3J0X3QgKHRjcF9zb2NrZXQgKG5hbWVfY29ubmVjdCkpKQogICAgKGFsbG93IHByb2Nlc3MgaHR0cF9wb3J0X3QgKHRjcF9zb2NrZXQgKHJlY3ZfbXNnIHNlbmRfbXNnKSkpCikKCihibG9jayBncmVtbGluCiAgICAoYmxvY2tpbmhlcml0IGNvbnRhaW5lcikKICAgIChibG9ja2luaGVyaXQgbmV0X2NvbnRhaW5lcikKICAgIChhbGxvdyBwcm9jZXNzIHByb2NfdCAobG5rX2ZpbGUgKHJlYWQpKSkKICAgIChhbGxvdyBwcm9jZXNzIGtlcm5lbF90IChzeXN0ZW0gKG1vZHVsZV9yZXF1ZXN0KSkpCiAgICAoYWxsb3cgcHJvY2VzcyBjb250YWluZXJfbG9nX3QgKCBkaXIgKCBvcGVuIHJlYWQgZ2V0YXR0ciBsb2NrIHNlYXJjaCBpb2N0bCBhZGRfbmFtZSByZW1vdmVfbmFtZSB3cml0ZSBjcmVhdGUgcm1kaXIgbW91bnRvbiApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl9sb2dfdCAoIGZpbGUgKCBnZXRhdHRyIHJlYWQgd3JpdGUgYXBwZW5kIGlvY3RsIGxvY2sgbWFwIG9wZW4gY3JlYXRlIHVubGluayApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl9sb2dfdCAoIHNvY2tfZmlsZSAoIGdldGF0dHIgcmVhZCB3cml0ZSBhcHBlbmQgb3BlbiApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl92YXJfbGliX3QgKCBkaXIgKCBvcGVuIHJlYWQgc2V0YXR0ciBnZXRhdHRyIGxvY2sgc2VhcmNoIGlvY3RsIGFkZF9uYW1lIHJlbW92ZV9uYW1lIHdyaXRlIGNyZWF0ZSBybWRpciBtb3VudG9uICkpKQogICAgKGFsbG93IHByb2Nlc3MgY29udGFpbmVyX3Zhcl9saWJfdCAoIGZpbGUgKCBzZXRhdHRyIGdldGF0dHIgcmVhZCB3cml0ZSBhcHBlbmQgaW9jdGwgbG9jayBtYXAgb3BlbiBjcmVhdGUgdW5saW5rIG1vdW50b24gKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBjb250YWluZXJfdmFyX2xpYl90ICggc29ja19maWxlICggZ2V0YXR0ciByZWFkIHdyaXRlIGFwcGVuZCBvcGVuICkpKQogICAgKGFsbG93IHByb2Nlc3MgY29udGFpbmVyX3Zhcl9saWJfdCAoIGxua19maWxlICggY3JlYXRlIHVubGluayApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl9ydW50aW1lX3QgKCB1bml4X3N0cmVhbV9zb2NrZXQgKCBjb25uZWN0dG8gKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBjb250YWluZXJfdmFyX3J1bl90ICggZmlsZSAoIGdldGF0dHIgcmVhZCBvcGVuIGNyZWF0ZSB3cml0ZSB1bmxpbmsgbW91bnRvbiApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl92YXJfcnVuX3QgKCBkaXIgKCB3cml0ZSBhZGRfbmFtZSBjcmVhdGUgc2V0YXR0ciByZW1vdmVfbmFtZSByZWFkIHJtZGlyIHVubGluayBtb3VudG9uICkpKQogICAgKGFsbG93IHByb2Nlc3MgY29udGFpbmVyX3Zhcl9ydW5fdCAoIGZpZm9fZmlsZSAoIGNyZWF0ZSBzZXRhdHRyIHVubGluayApKSkKICAgIChhbGxvdyBwcm9jZXNzIGNvbnRhaW5lcl90ICggZGlyICggc2VhcmNoIGdldGF0dHIgcmVhZCBvcGVuICkpKQogICAgKGFsbG93IHByb2Nlc3MgY29udGFpbmVyX3QgKCBmaWxlICggcmVhZCBvcGVuIGdldGF0dHIgKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBjb250YWluZXJfdCAoIGxua19maWxlICggZ2V0YXR0ciByZWFkIG9wZW4gKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBOZXR3b3JrTWFuYWdlcl90ICggZmlsZSAoIGdldGF0dHIgcmVhZCBvcGVuICkpKQogICAgKGFsbG93IHByb2Nlc3MgY2dyb3VwX3QgKCBmaWxlICggd3JpdGUgcmVhZCBjcmVhdGUgKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBjZ3JvdXBfdCAoIGRpciAoIHdyaXRlIGFkZF9uYW1lIHJlbW92ZV9uYW1lIHJtZGlyICkpKQogICAgKGFsbG93IHByb2Nlc3MgcHJvY190ICggZmlsZXN5c3RlbSAoIG1vdW50ICkpKQogICAgKGFsbG93IHByb2Nlc3MgdG1wZnNfdCAoIGZpbGVzeXN0ZW0gKCBtb3VudCApKSkKICAgIChhbGxvdyBwcm9jZXNzIGRldnB0c190ICggZmlsZXN5c3RlbSAoIG1vdW50ICkpKQogICAgKGFsbG93IHByb2Nlc3Mgc3lzZnNfdCAoIGZpbGVzeXN0ZW0gKCBtb3VudCApKSkKICAgIChhbGxvdyBwcm9jZXNzIHNwY190ICggZGlyICggc2VhcmNoIGdldGF0dHIgb3BlbiByZWFkICkpKQogICAgKGFsbG93IHByb2Nlc3Mgc3BjX3QgKCBmaWxlICggcmVhZCBvcGVuIGdldGF0dHIgKSkpCiAgICAoYWxsb3cgcHJvY2VzcyBzcGNfdCAoIGxua19maWxlICggZ2V0YXR0ciByZWFkIG9wZW4gKSkpCik=
          verification: {}
        mode: 0755
    systemd:
      units:
        - contents: |
            [Unit]
            Requires=systemd-udevd.target
            After=systemd-udevd.target
            Before=NetworkManager.service
            DefaultDependencies=no
            [Service]
            Type=oneshot
            ExecStart=/usr/sbin/semodule -i /etc/selinux/gremlin-ocp4.cil
            [Install]
            WantedBy=multi-user.target
          name: one-shot-gremlin-ocp4.service
          enabled: true
